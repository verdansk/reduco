<div class="container">
  <div class="row">
    <div class="col-sm-12 col-lg-8">
      <div class="user-bar back-border mt-1 mb-1">
        <div class="row">
          <div class="col-sm-12 col-lg-4 mt-1">
            <h2 class="text-center"><strong><%= @user.first_name %></strong></h2>
            <div class="flex-small-screen">
              <%= image_tag(@animal, class: 'animal mt-2 pic-center') %>
              <p class="mt-2 ml-4">Lorem ipsum, dolor sit amet consectetur adipisicing elit. Repellat laborum reiciendis eos.</p>
            </div>
          </div>

          <div class="col-sm-12 col-lg-8 mt-1">
            <h3 class="mb-4 text-shadow"><strong><%= @user.full_name %></strong>, your personal progress for today</h3>
            <div class="prog-small-screen">
              <div class="progress-bar">
                <div class="progress-bar-item">
                  <%= image_tag('bear.svg', class: 'animal-small') %>
                  <p>less 100XP</p>
                </div>
                <div class="progress-bar-item">
                  <%= image_tag('lion.svg', class: 'animal-small') %>
                  <p>200XP</p>
                </div>
                <div class="progress-bar-item">
                  <%= image_tag('fox.svg', class: 'animal-small') %>
                  <p>300XP</p>
                </div>
                <div class="progress-bar-item">
                  <%= image_tag('penguin.svg', class: 'animal-small') %>
                  <p>400XP</p>
                </div>
                <div class="progress-bar-item">
                  <%= image_tag('owl.svg', class: 'animal-small') %>
                  <p>500XP</p>
                </div>
                <div class="progress-bar-item">
                  <%= image_tag('bird.svg', class: 'animal-small') %>
                  <p>more 600XP</p>
                </div>
              </div>
              <%= link_to new_user_survey_path(current_user) do  %>
              <button class="btn mt-4"><i class="fas fa-calculator"></i>
              Recalculate</button>
              <% end %>
            </div>
          </div>
        </div>
      </div>

      <div class="challenge-bar back-border">
        <div class="d-flex flex-row justify-content-between align-items-center mt-1 mb-3">
          <h2 class="ml-2 text-shadow">Challenges</h2>

        </div>
        <div class="d-flex justify-content-between flex-wrap ml-3 mr-3">
          <% Challenge.all.each do |challenge| %>
          <div class="challenge-card" id="challenge-anchor">
            <div class="card-picture"><%= image_tag('shower.svg', class: 'animal-mid center') %></div>
            <div class="card-info">
              <div class="num-xp"> <%= challenge.xp %>XP</div>
              <h3 class="text-center"><%= challenge.name.capitalize %> challenge</h3>
              <p class="p-1"><%= challenge.description %></p>
              <!-- choose method pluralized -->

              <% user_challenge = UserChallenge.where(challenge: challenge, user: current_user).first %>

              <% if user_challenge.nil? %>
                 <p class="p-1"> Duration: <%= challenge.duration %> day(s)</p>
                <% elsif user_challenge.status == "started" %>
                   <p class="p-1"> Time remaining: <%= user_challenge.time_ago  %></p>
              <% end %>
            </div>
            <div class="d-flex justify-content-center mb-3">
              <% if user_challenge.nil? %>
                    <%= button_to "Accept", accept_challenge_path(challenge), remote: true, method: :post , class: "btn"%>
                <% elsif user_challenge.duration_passed? && user_challenge.status != "finished" %>

                  <%= button_to "Complete?", complete_challenge_path(user_challenge), remote: true, method: :post, class: "btn" %>
                <% elsif user_challenge.status == "finished"%>
                  <p>Completed, Well done!</p>
                <% end %>
            </div>
          </div>
          <% end %>

        </div>
      </div>
    </div>
    <div class=" col-sm-12 col-lg-4">
      <div class="friends-bar back-border mt-1 mb-1">
        <div>
          <div class="dropdown">
            <%= form_tag (search_user_path),method: :post , class: "d-flex" do %>
            <%= text_field_tag :search %>
            <%= submit_tag 'Search'%>
            <% end %>
            <ul>
              <% if @search_users %>
              <% @search_users.each do |user| %>
              <li><%= user.first_name%><%= link_to "add", new_friendship_path(current_user.id,user.id)%>
              </li>
              <% end %>
              <% end %>
            </ul>
          </div>

        <div class="searchbar">
          <%= form_tag(new_friendship_path, method: :post,remote: true, class: "form-inline") do %>
          <%= hidden_field_tag :authenticity_token, form_authenticity_token %>
          <%= select_tag "user_id", options_from_collection_for_select( @users,:id,:first_name), class: 'select2' , onchange: "this.form.submit()", placeholder: "test" %>
          <% end %>

        </div>



        <div class="d-flex flex-row justify-content-between align-items-center mt-1 mb-3 mr-2">
          <h3 class="ml-2 text-shadow">Friends</h3>
          <a href="">Invite more friends <i class="fas fa-plus"></i></a>
          <%#= link_to (path) do %>
          <!--   -->
          <%# end %>
        </div>
        <div class="friends mb-2">
          <% current_user.friendships.each do |friend|%>
          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('woman.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p><%= User.find(friend.friend_id).first_name.capitalize %></p></div>
            <div class="col-3">
              <div class="avatar-num-xp "><%= User.find(friend.friend_id).xp %></div>
            </div>
            <div class="col-3">
              <%= image_tag('lion.svg', class: 'avatar') %>
            </div>
          </div>
          <% end %>

          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('woman.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p>Friend's name</p></div>
            <div class="col-3">
              <div class="avatar-num-xp ">200XP</div>
            </div>
            <div class="col-3">
              <%= image_tag('lion.svg', class: 'avatar') %>
            </div>
          </div>
          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('woman.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p>Friend's name</p></div>
            <div class="col-3">
              <div class="avatar-num-xp ">300XP</div>
            </div>
            <div class="col-3">
              <%= image_tag('fox.svg', class: 'avatar') %>
            </div>
          </div>
          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('man.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p>Friend's name</p></div>
            <div class="col-3">
              <div class="avatar-num-xp ">400XP</div>
            </div>
            <div class="col-3">
              <%= image_tag('penguin.svg', class: 'avatar') %>
            </div>
          </div>
          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('woman.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p>Friend's name</p></div>
            <div class="col-3">
              <div class="avatar-num-xp ">500XP</div>
            </div>
            <div class="col-3">
              <%= image_tag('owl.svg', class: 'avatar') %>
            </div>
          </div>
          <div class="row mb-1">
            <div class="col-2">
              <%= image_tag('man.svg', class: 'avatar') %>
            </div>
            <div class="col-4"><p>Friend's name</p></div>
            <div class="col-3">
              <div class="avatar-num-xp ">700XP</div>
            </div>
            <div class="col-3">
              <%= image_tag('bird.svg', class: 'avatar') %>
            </div>
          </div>
        </div>

      </div>
      <div class="history-bar back-border mt-1 mb-1">
        <h3 class="ml-2 text-shadow text-24">Completed Challenges</h3>
        <!-- Add links to the previous challenge cards -->
        <div class="d-flex justify-content-between flex-wrap gap-between mt-1 ml-3 mr-3">

         <% @challenges.each do |user_challenge| %>
         <% if user_challenge.completed %>
         <div class="challenge-card-mini">
          <div class="card-picture"><%= image_tag('shower.svg', class: 'animal-mid center') %></div>
          <div class="card-info">
            <h3 class="text-center"><%= user_challenge.challenge.name %></h3>

          </div>
        </div>
        <% end %>
        <% end %>
      </div>
    </div>
    <div class="transport-bar back-border mt-1 mb-1">
      <h3 class="ml-2 text-shadow text-24">Last added transport</h3>
      <!-- Add links to the previous challenge cards -->
      <div class="d-flex justify-content-between flex-wrap gap-between mt-1 ml-3 mr-3">
       <div class="transport-card">
        <% if @user.transports.last&.category == "car" %>
        <h4> <i class="fas fa-car"></i> <%= @user.transports.last&.value %> CO2/year </h4>
        <%  elsif @user.transports.last&.category == "bike" %>
        <h4> <i class="fas fa-bicycle"></i> <%= @user.transports.last&.value %> CO2/year </h4>
        <%#  elsif @user.transports.last&.category == "plane" %>
        <!-- <h4> <i class="fas fa-plane"></i> <%#= @user.transports.last&.value %> CO2/year </h4> -->
        <%#  elsif @user.transports.last&.category == "train" %>
        <!-- <h4> <i class="fas fa-train"></i> <%#= @user.transports.last&.value %> CO2/year </h4> -->
        <% else %>
        <h4> <i class="fas fa-fish"></i> explore your daily emmision... </h4>
        <% end %>
      </div>
    </div>
  </div>
</div>
</div>
</div>

<!-- <script>
  document.getElementById("challenge-accept").addEventListener("click", function() {
  document.getElementById("challenge-accept").innerHTML = "In progress";
  document.getElementById("challenge-accept").disabled = true;
});
</script> -->

